name: üöÄ Windows 11 RDP via Ngrok (6 Hours)

on:
  workflow_dispatch:

jobs:
  RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 360  # Max GitHub Actions limit

    steps:
    - name: üßº Enable RDP, Create User & Configure Firewall
      shell: pwsh
      run: |
        # Enable RDP
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

        # Check if user exists, if not create
        $user = Get-LocalUser -Name "runneradmin" -ErrorAction SilentlyContinue
        if (-not $user) {
          net user runneradmin P@ssw0rd123 /add
        }

        # Add to administrators group if not already
        $admins = net localgroup administrators
        if ($admins -notmatch "runneradmin") {
          net localgroup administrators runneradmin /add
        }

        Write-Output "‚úÖ RDP Enabled, firewall configured, user ready."

    - name: üõ†Ô∏è Download & Install Ngrok
      shell: pwsh
      run: |
        Invoke-WebRequest -Uri "https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-windows-amd64.zip" -OutFile "$env:USERPROFILE\ngrok.zip"
        Expand-Archive "$env:USERPROFILE\ngrok.zip" -DestinationPath "$env:USERPROFILE\ngrok"
        echo "‚úÖ Ngrok downloaded and extracted."

    - name: üîê Configure Ngrok Auth Token
      shell: pwsh
      run: |
        & "$env:USERPROFILE\ngrok\ngrok.exe" authtoken "${{ secrets.NGROK_AUTH_TOKEN }}"
        echo "‚úÖ Ngrok auth token set."

    - name: üö™ Start Ngrok TCP Tunnel for RDP
      shell: pwsh
      run: |
        Start-Process -NoNewWindow -FilePath "$env:USERPROFILE\ngrok\ngrok.exe" -ArgumentList "tcp 3389"
        Start-Sleep -Seconds 10
        echo "‚úÖ Ngrok TCP tunnel started."

    - name: üåê Get Ngrok Public RDP Address
      id: ngrok
      shell: pwsh
      run: |
        $tunnel = Invoke-RestMethod -Uri "http://127.0.0
