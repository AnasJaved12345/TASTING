# .github/workflows/windows-rdp.yml
name: âš¡ Windows RDP with Ngrok

on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360  # GitHub runner max time ~6 hours

    steps:
    - name: ğŸ§ª System Info
      run: |
        systeminfo

    - name: ğŸ”½ Download & Configure Ngrok
      run: |
        Invoke-WebRequest https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-windows-amd64.zip -OutFile ngrok.zip
        Expand-Archive ngrok.zip -DestinationPath $PWD
        ./ngrok authtoken $Env:NGROK_TOKEN

    - name: ğŸ” Enable RDP and set password
      run: |
        net user runneradmin "RDPpassword123!"  # Strong password
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\' -name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

    - name: ğŸš€ Start Ngrok tunnel for RDP (port 3389)
      run: |
        Start-Process -NoNewWindow -FilePath "$PWD\ngrok.exe" -ArgumentList "tcp 3389"

    - name: ğŸ§  Show RDP address
      run: |
        Start-Sleep -Seconds 10
        $url = Invoke-RestMethod http://127.0.0.1:4040/api/tunnels
        $public_url = $url.tunnels[0].public_url
        Write-Output "âœ… Connect to your RDP with:"
        Write-Output "ğŸ‘‰ Address: $($public_url.Replace("tcp://", ""))"
        Write-Output "ğŸ‘‰ User: runneradmin"
        Write-Output "ğŸ‘‰ Password: RDPpassword123!"

    - name: ğŸ”§ Install Development Tools
      run: |
        winget install -e --id Python.Python.3
        winget install -e --id Google.Chrome
        winget install -e --id Microsoft.VisualStudioCode
        echo "âœ… Development tools installed."

